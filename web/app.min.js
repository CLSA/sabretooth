"use strict";var cenozo=angular.module("cenozo");cenozo.controller("HeaderCtrl",["$scope","$state","CnBaseHeader","CnSession","CnHttpFactory","CnModalConfirmFactory","CnModalMessageFactory",function($scope,$state,CnBaseHeader,CnSession,CnHttpFactory,CnModalConfirmFactory,CnModalMessageFactory){CnBaseHeader.construct($scope);CnSession.promise.then(function(){CnSession.alertHeader=null==CnSession.user.assignment?undefined:"You are currently in an assignment";CnSession.onAlertHeader=function(){if(angular.isDefined(cenozoApp.module("assignment").actions.control)){$state.go("assignment.control")}else{CnModalMessageFactory.instance({title:"Switch Roles For Assignment",message:"You cannot access your assignment under your current site and role. "+"The site and role selection dialog will now be opened, please use it to switch to the site and "+"role under which you started the assignment.\n\n"+"Once you have switched you will be able to access your assignment.",error:true}).show().then(function(){CnSession.showSiteRoleModal()})}}});var logoutOperation=$scope.operationList.findByProperty("title","Logout");var logoutFunction=logoutOperation.execute;logoutOperation.execute=function(){function showAssignmentExists(){var hasAccess=angular.isDefined(cenozoApp.module("assignment").actions.control);CnModalMessageFactory.instance({title:"Active Assignment Detected",message:"You cannot log out while in an open assignment!\n\n"+(hasAccess?"In order to log out you will need to close your open assignment. "+"You will now be redirected to your assignment.":"In order to log out you will need to close your open assignment, however, you cannot access "+"your assignment from your current site and role. "+"The site and role selection dialog will now be opened, please use it to switch to the site and "+"role under which you started the assignment.\n\n"+"Once you have switched you will be able to access your assignment."),error:true}).show().then(function(){if(hasAccess)$state.go("assignment.control");else CnSession.showSiteRoleModal()})}CnHttpFactory.instance({path:"assignment/0",onError:function(response){if(307==response.status){logoutFunction()}else if(403==response.status){showAssignmentExists()}else{CnModalMessageFactory.httpError(response)}}}).get().then(function(){showAssignmentExists()})}}]);
